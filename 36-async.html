
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="canonical" href="https://nus-cs2030s.github.io/2021-s2/36-async.html">
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.1.3">
    
    
      
        <title>36. Async - CS2030S Programming Methodology II</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.e35208c4.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.ef6f36e2.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="stylesheets/extra.css">
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,700">
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600;1,700&display=swap">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL(".",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#unit-36-asynchronous-programming" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="CS2030S Programming Methodology II" class="md-header__button md-logo" aria-label="CS2030S Programming Methodology II" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CS2030S Programming Methodology II
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              36. Async
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="CS2030S Programming Methodology II" class="md-nav__button md-logo" aria-label="CS2030S Programming Methodology II" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    CS2030S Programming Methodology II
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      <label class="md-nav__link" for="__nav_2">
        Notes
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Notes" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Notes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" >
      
      <label class="md-nav__link" for="__nav_2_1">
        Introduction (00-03)
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Introduction (00-03)" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          Introduction (00-03)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="00-overview.html" class="md-nav__link">
        0. Overview
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="01-compiler.html" class="md-nav__link">
        1. Program and Compiler
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="02-type.html" class="md-nav__link">
        2. Variable and Type
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="03-function.html" class="md-nav__link">
        3. Functions
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" >
      
      <label class="md-nav__link" for="__nav_2_2">
        OOP (04-16)
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="OOP (04-16)" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          OOP (04-16)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="04-encapsulation.html" class="md-nav__link">
        4. Encapsulation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="05-infohiding.html" class="md-nav__link">
        5. Information Hiding
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="06-tell-dont-ask.html" class="md-nav__link">
        6. Tell, Don't Ask
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="07-static-field.html" class="md-nav__link">
        7. Class Fields
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="08-static-method.html" class="md-nav__link">
        8. Class Methods
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="09-composition.html" class="md-nav__link">
        9. Composition
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="10-inheritance.html" class="md-nav__link">
        10. Inheritance
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="11-overriding.html" class="md-nav__link">
        11. Overriding
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="12-polymorphism.html" class="md-nav__link">
        12. Polymorphism
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="13-lsp.html" class="md-nav__link">
        13. Liskov Substitution Principle
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="14-abstract.html" class="md-nav__link">
        14. Abstract Class
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="15-interface.html" class="md-nav__link">
        15. Interface
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="16-wrapper.html" class="md-nav__link">
        16. Wrapper Class
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" type="checkbox" id="__nav_2_3" >
      
      <label class="md-nav__link" for="__nav_2_3">
        Types (17-24)
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Types (17-24)" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Types (17-24)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="17-casting.html" class="md-nav__link">
        17. Casting
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="18-variance.html" class="md-nav__link">
        18. Variance
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="19-exception.html" class="md-nav__link">
        19. Exception
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="20-generics.html" class="md-nav__link">
        20. Generics
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="21-erasure.html" class="md-nav__link">
        21. Type Erasure
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="22-unchecked.html" class="md-nav__link">
        22. Unchecked Warnings
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="23-wildcard.html" class="md-nav__link">
        23. Wildcards
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="24-inference.html" class="md-nav__link">
        24. Type Inference
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4" type="checkbox" id="__nav_2_4" >
      
      <label class="md-nav__link" for="__nav_2_4">
        Functional (25-33)
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Functional (25-33)" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          Functional (25-33)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="25-immutability.html" class="md-nav__link">
        25. Immutability
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="26-nested-classes.html" class="md-nav__link">
        26. Nested Classes
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="27-functions.html" class="md-nav__link">
        27. Functions
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="28-box-maybe.html" class="md-nav__link">
        28. Box and Maybe
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="29-lazy.html" class="md-nav__link">
        29. Lazy Evaluation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="30-infinitelist.html" class="md-nav__link">
        30. Infinite List
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="31-stream.html" class="md-nav__link">
        31. Stream
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="32-logger.html" class="md-nav__link">
        32. Loggable
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="33-monad.html" class="md-nav__link">
        33. Monad
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5" type="checkbox" id="__nav_2_5" checked>
      
      <label class="md-nav__link" for="__nav_2_5">
        Parallel (34-37)
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Parallel (34-37)" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_5">
          <span class="md-nav__icon md-icon"></span>
          Parallel (34-37)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="34-parallel.html" class="md-nav__link">
        34. Parallel Streams
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="35-thread.html" class="md-nav__link">
        35. Threads
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          36. Async
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="36-async.html" class="md-nav__link md-nav__link--active">
        36. Async
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#limitations-of-thread" class="md-nav__link">
    Limitations of Thread
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-higher-level-abstraction" class="md-nav__link">
    A Higher-Level Abstraction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-completablefuture-monad" class="md-nav__link">
    The CompletableFuture Monad
  </a>
  
    <nav class="md-nav" aria-label="The CompletableFuture Monad">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-completablefuture" class="md-nav__link">
    Creating a CompletableFuture
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chaining-completablefuture" class="md-nav__link">
    Chaining CompletableFuture
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-the-result" class="md-nav__link">
    Getting The Result
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-exceptions" class="md-nav__link">
    Handling Exceptions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="37-forkjoin.html" class="md-nav__link">
        37. Fork and Join
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="final-with-answers.pdf" class="md-nav__link">
        Final
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        Guide
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="environments.html" class="md-nav__link">
        Programming Environments
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      <label class="md-nav__link" for="__nav_4_2">
        Using Unix CLI
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Using Unix CLI" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Using Unix CLI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="unix-background.html" class="md-nav__link">
        Background
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="unix-essentials.html" class="md-nav__link">
        Essentials
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="unix-advanced.html" class="md-nav__link">
        Advanced
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="vim.html" class="md-nav__link">
        Using Vim
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="plugins.html" class="md-nav__link">
        Vim Plugins on PE
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="style.html" class="md-nav__link">
        Java Style Guide
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="javadoc.html" class="md-nav__link">
        JavaDoc Guide
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="lab.html" class="md-nav__link">
        Lab Guide
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="references.html" class="md-nav__link">
        References
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#limitations-of-thread" class="md-nav__link">
    Limitations of Thread
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-higher-level-abstraction" class="md-nav__link">
    A Higher-Level Abstraction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-completablefuture-monad" class="md-nav__link">
    The CompletableFuture Monad
  </a>
  
    <nav class="md-nav" aria-label="The CompletableFuture Monad">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-completablefuture" class="md-nav__link">
    Creating a CompletableFuture
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#chaining-completablefuture" class="md-nav__link">
    Chaining CompletableFuture
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-the-result" class="md-nav__link">
    Getting The Result
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handling-exceptions" class="md-nav__link">
    Handling Exceptions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="unit-36-asynchronous-programming">Unit 36: Asynchronous Programming</h1>
<h2 id="limitations-of-thread">Limitations of <code>Thread</code></h2>
<p>Writing code directly with the <code>Thread</code> class gives us control on how many threads to create, what they do, how they communicate with each other, and some level of control on which thread gets executed when.  While Java's <code>Thread</code> is already a higher-level abstraction compared to, say, the <code>pthread</code> library in C and C++, it still takes a fair amount of effort to write complex multi-threaded programs in Java.</p>
<p>Consider the situation where we have a series of tasks that we wish to execute <em>concurrently</em> and we want to organize them such that:
- Task A must start first
- When Task A is done, we take the result from Task A, and pass it to Tasks B, C, and D.
- We want Task B and C to complete before we pass their results to Task E.  </p>
<p>We also want to handle exceptions gracefully -- if one of the tasks encounters an exception, the other tasks not dependent on it should still be completed.</p>
<p>Implementing the above using <code>Thread</code> requires careful coordination.  Firstly, there are no methods in <code>Thread</code> that return a value.  We need the threads to communicate through shared variables.  Secondly, there is no mechanism to specify the execution order and dependencies among them -- which thread to start after another thread completes.  Finally, we have to consider the possibility of exceptions in each of our tasks.</p>
<p>Another drawback of using <code>Thread</code> is its overhead -- the creation of <code>Thread</code> instances takes up some resources in Java.  As much as possible, we should reuse our <code>Thread</code> instances to run multiple tasks.  For instance, the same <code>Thread</code> instance could have run Tasks A, B, and E in the example above.  Managing the <code>Thread</code> instances itself and deciding which <code>Thread</code> instance should run which <code>Thread</code> is a gigantic undertaking.</p>
<h2 id="a-higher-level-abstraction">A Higher-Level Abstraction</h2>
<p>What we need is a higher-level abstraction that allows programmers to focus on specifying the tasks and their dependencies, without worrying about the details.  Suppose we want to run the tasks in a single thread, we could do the following:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kt">int</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="n">taskA</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="n">taskB</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="n">taskC</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">d</span> <span class="o">=</span> <span class="n">taskD</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">e</span> <span class="o">=</span> <span class="n">taskE</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">e</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>We could also use monads to chain up the computations.  Let's say that one of the tasks might not produce a value, then we can use the <code>Maybe&lt;T&gt;</code> monad:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">Maybe</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Maybe</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">Maybe</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="n">Maybe</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="na">flatMap</span><span class="p">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">taskB</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
    <span class="n">Maybe</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="na">flatMap</span><span class="p">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">taskC</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
    <span class="n">Maybe</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="na">flatMap</span><span class="p">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">taskD</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
    <span class="n">Maybe</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="na">combine</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">taskE</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">));</span>
    <span class="k">return</span> <span class="n">e</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>If we want to perform the tasks lazily, then we can use the <code>Lazy&lt;T&gt;</code> monad:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">Lazy</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Lazy</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">Lazy</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="n">Lazy</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="na">flatMap</span><span class="p">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">taskB</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
    <span class="n">Lazy</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="na">flatMap</span><span class="p">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">taskC</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
    <span class="n">Lazy</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="na">flatMap</span><span class="p">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">taskD</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
    <span class="n">Lazy</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="na">combine</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">taskE</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">));</span>
    <span class="k">return</span> <span class="n">e</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>Wouldn't it be nice if there is a monad that allows us to perform the tasks concurrently?  <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/CompletableFuture.html"><code>java.util.concurrent.CompletableFuture</code></a> does just that!  Here is an example of how to use it:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">int</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">CompletableFuture</span><span class="p">.</span><span class="na">completedFuture</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="na">thenComposeAsync</span><span class="p">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">taskB</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
    <span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="na">thenComposeAsync</span><span class="p">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">taskC</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
    <span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="na">thenComposeAsync</span><span class="p">(</span><span class="n">i</span> <span class="o">-&gt;</span> <span class="n">taskD</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
    <span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="na">thenCombineAsync</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">taskE</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">));</span>
    <span class="k">return</span> <span class="n">e</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>We can then run <code>foo(x).get()</code> to wait for all the concurrent tasks to complete and return us the value.  <code>CompletableFuture&lt;T&gt;</code> is a monad that encapsulates a value that is either there or not there <em>yet</em>.  Such an abstraction is also known as a promise in other languages (e.g., <code>Promise</code> in JavaScript and <code>std::promise</code> in C++)
-- it encapsulates the promise to produce a value.</p>
<h2 id="the-completablefuture-monad">The <code>CompletableFuture</code> Monad</h2>
<p>Let's now examine the <code>CompletableFuture</code> monad in more detail.  A key property of <code>CompletableFuture</code> is whether the value it promises is ready -- i.e., the tasks that it encapsulates has <em>completed</em> or not.</p>
<h3 id="creating-a-completablefuture">Creating a <code>CompletableFuture</code></h3>
<p>There are several ways we can create a <code>CompletableFuture&lt;T&gt;</code> instance:</p>
<ul>
<li>Use the <code>completedFuture</code> method.  This method is equivalent to creating a task that is already completed and return us a value.  </li>
<li>Use the <code>runAsync</code> method that takes in a <code>Runnable</code> lambda expression.  <code>runAsync</code> has the return type of <code>CompletableFuture&lt;Void&gt;</code>.  The returned <code>CompletableFuture</code> instance completes when the given lambda expression finishes.</li>
<li>Use the <code>supplyAsync</code> method that takes in a <code>Supplier&lt;T&gt;</code> lambda expression.  <code>supplyAsync</code> has the return type of <code>CompletableFuture&lt;T&gt;</code>.  The returned <code>CompletableFuture</code> instance completes when the given lambda expression finishes.</li>
</ul>
<p>We can also create a <code>CompletableFuture</code> that relies on other <code>CompletableFuture</code> instances.  We can use <code>allOf</code> or <code>anyOf</code> methods for this.  Both of these methods take in a variable number of other <code>CompletableFuture</code> instances.  A new <code>CompletableFuture</code> created with <code>allOf</code> is completed only when all the given <code>CompletableFuture</code> completes.  On the other hand, a new <code>CompletableFuture</code> created with <code>anyOf</code> is completed when any one of the given <code>CompletableFuture</code> completes.</p>
<h3 id="chaining-completablefuture">Chaining <code>CompletableFuture</code></h3>
<p>The usefulness of <code>CompletableFuture</code> comes from the ability to chain them up and specify a sequence of computations to be run.  We have the following methods:</p>
<ul>
<li><code>thenApply</code>, which is analogous to <code>map</code></li>
<li><code>thenCompose</code>, which is analogous to <code>flatMap</code></li>
<li><code>thenCombine</code>, which is analogous to <code>combine</code></li>
</ul>
<p>The methods above run the given lambda expression in the same thread as the caller.  There is also an asynchronous version (<code>thenApplyAsync</code>, <code>thenComposeAsync</code>, <code>thenCombineAsync</code>), which may cause the given lambda expression to run in a different thread (thus more concurrency).</p>
<h3 id="getting-the-result">Getting The Result</h3>
<p>After we have set up all the tasks to run asynchronously, we have to wait for them to complete.  We can call <code>get()</code> to get the result.  Since <code>get()</code> is a synchronous call, i.e., it blocks until the <code>CompletableFuture</code> completes, to maximize concurrency, we should only call <code>get()</code> as the final step in our code.</p>
<p>The method <code>CompletableFuture::get</code> throws a couple of checked exceptions: <code>InterruptedException</code> and <code>ExecutionException</code>, which we need to catch and handle.  The former refers to the exception that the thread has been interrupted, while the latter refers to errors/exceptions during execution.</p>
<p>An alternative to <code>get()</code> is <code>join()</code>.  <code>join()</code> behaves just like <code>get()</code> except that no checked exception is thrown.</p>
<h3 id="example">Example</h3>
<p>Let's look at some examples.  Let's reuse our method that computes the i-th prime number.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kt">int</span> <span class="nf">findIthPrime</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">Stream</span>
        <span class="p">.</span><span class="na">iterate</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="n">isPrime</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="p">.</span><span class="na">limit</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="p">.</span><span class="na">reduce</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">y</span><span class="p">)</span>
        <span class="p">.</span><span class="na">orElse</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>
<p>Given two numbers i and j, we want to find the difference between the i-th prime number and the j-th prime number.  We can first do the following:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">ith</span> <span class="o">=</span> <span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span> <span class="o">-&gt;</span> <span class="n">findIthPrime</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
<span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">jth</span> <span class="o">=</span> <span class="n">CompletableFuture</span><span class="p">.</span><span class="na">supplyAsync</span><span class="p">(()</span> <span class="o">-&gt;</span> <span class="n">findIthPrime</span><span class="p">(</span><span class="n">j</span><span class="p">));</span>
</code></pre></div>
</td></tr></table>
<p>These calls would launch two concurrent threads to compute the i-th and the j-th primes.   The method calls <code>supplyAsync</code> returns immediately without waiting for <code>findIthPrime</code> to complete.</p>
<p>Next, we can say, that, when <code>ith</code> and <code>jth</code> complete, take the value computed by them, and take the difference.  We can use the <code>thenCombine</code> method:
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">CompletableFuture</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">diff</span> <span class="o">=</span> <span class="n">ith</span><span class="p">.</span><span class="na">thenCombine</span><span class="p">(</span><span class="n">jth</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">);</span>
</code></pre></div>
</td></tr></table></p>
<p>This statement creates another <code>CompletableFuture</code> which runs asynchronously that will compute the difference between the two prime numbers.  At this point, we can move on to run other tasks, or if we just want to wait until the result is ready, we call
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">diff</span><span class="p">.</span><span class="na">join</span><span class="p">();</span>
</code></pre></div>
</td></tr></table></p>
<p>to get the difference between the two primes<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>.</p>
<h3 id="handling-exceptions">Handling Exceptions</h3>
<p>One of the advantages of using <code>CompletableFuture&lt;T&gt;</code> instead of <code>Thread</code> to handle concurrency is its ability to handle exceptions.  <code>CompletableFuture&lt;T&gt;</code> has three methods that deal with exceptions: <code>exceptionally</code>, <code>whenComplete</code>, and <code>handle</code>.   We will focus on <code>handle</code> since it is the most general.</p>
<p>Suppose we have a computation inside a <code>CompletableFuture&lt;T&gt;</code> that might throw an exception.  Since the computation is asynchronous and could run in a different thread, the question of which thread should catch and handle the exception arises.  <code>CompletableFuture&lt;T&gt;</code> keeps things simpler by storing the exception and passing it down the chain of calls, until <code>join()</code> is called.  <code>join()</code> might throw <code>CompletionException</code> and whoever calls <code>join()</code> will be responsible for handling this exception.  The <code>CompletionException</code> contains information on the original exception.</p>
<p>For instance, the code below would throw a <code>CompletionException</code> with a <code>NullPointerException</code> contains within it.</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">CompletableFuture</span><span class="p">.</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="n">supplyAsync</span><span class="p">(()</span> <span class="o">-&gt;</span> <span class="kc">null</span><span class="p">)</span>
  <span class="p">.</span><span class="na">thenApply</span><span class="p">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">.</span><span class="na">join</span><span class="p">();</span>
</code></pre></div>
</td></tr></table>
<p>Suppose we want to continue chaining our tasks despite exceptions.  We can use the <code>handle</code> method, to handle the exception.  The <code>handle</code> method takes in a <code>BiFunction</code> (similar to <code>cs2030s.fp.Combiner</code>).  The first parameter to the <code>BiFunction</code> is the value, the second is the exception, the third is the return value.</p>
<p>Only one of the first two parameters is not <code>null</code>.  If the value is <code>null</code>, this means that an exception has been thrown.  Otherwise, the exception is <code>null</code><sup id="fnref:2"><a class="footnote-ref" href="#fn:2">2</a></sup>.    </p>
<p>Here is a simple example where we use <code>handle</code> to replace a default value.
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>  <span class="n">cf</span><span class="p">.</span><span class="na">thenApply</span><span class="p">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">.</span><span class="na">handle</span><span class="p">((</span><span class="n">t</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">e</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="o">?</span> <span class="n">t</span> <span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">.</span><span class="na">join</span><span class="p">();</span>
</code></pre></div>
</td></tr></table></p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>There is repeated computation in primality checks between the two calls to <code>findIthPrime</code> here, which one could optimize.  We don't do that here to keep the example simple.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p>This is another instance where Java uses <code>null</code> to indicates a missing value.  We can't use <code>null</code> as a legit value due to this flawed design.&#160;<a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
</ol>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="35-thread.html" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              35. Threads
            </div>
          </div>
        </a>
      
      
        <a href="37-forkjoin.html" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              37. Fork and Join
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright by Department of Computer Science, National University of Singapore 2021
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "assets/javascripts/workers/search.fe42c31b.min.js", "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.4ea5477f.min.js"></script>
      
        <script src="javascripts/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
      
    
  </body>
</html>